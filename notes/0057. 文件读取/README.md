# [0057. æ–‡ä»¶è¯»å–](https://github.com/tnotesjs/TNotes.nodejs/tree/main/notes/0057.%20%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96)

<!-- region:toc -->

- [1. ğŸ“ æ¦‚è¿°](#1--æ¦‚è¿°)
- [2. ğŸ’» demos.1 - å¼‚æ­¥è¯»å– - `fs.readFile`](#2--demos1---å¼‚æ­¥è¯»å–---fsreadfile)
- [3. ğŸ’» demos.2 - åŒæ­¥è¯»å– - `fs.readFileSync`](#3--demos2---åŒæ­¥è¯»å–---fsreadfilesync)
- [4. ğŸ’» demos.3 - æµå¼è¯»å– - `fs.createReadStream`](#4--demos3---æµå¼è¯»å–---fscreatereadstream)
- [5. ğŸ’» demos.4 - æ¨¡æ‹Ÿå¬æ­Œæ—¶æ˜¾ç¤ºæ­Œè¯çš„æ•ˆæœ](#5--demos4---æ¨¡æ‹Ÿå¬æ­Œæ—¶æ˜¾ç¤ºæ­Œè¯çš„æ•ˆæœ)
- [6. ğŸ”— å¼•ç”¨](#6--å¼•ç”¨)

<!-- endregion:toc -->

## 1. ğŸ“ æ¦‚è¿°

- **è¯»å–æ–‡ä»¶**
  - åœ¨ Node.js ä¸­ï¼Œæ–‡ä»¶è¯»å–æ˜¯ä¸€ä¸ªå¸¸è§çš„æ“ä½œï¼Œé€šå¸¸ç”¨äºå¤„ç†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•°æ®ã€‚
  - Node.js æä¾›äº†å†…ç½®çš„ `fs`ï¼ˆFile Systemï¼‰æ¨¡å—æ¥å®ç°æ–‡ä»¶çš„è¯»å–ã€å†™å…¥ä»¥åŠå…¶ä»–æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚
- **ç¼–ç **
  - åœ¨è¯»å–æ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ `options` å‚æ•°æŒ‡å®šç¼–ç ã€‚
  - å¦‚æœæœªæŒ‡å®šç¼–ç ï¼Œè¿”å›çš„æ•°æ®å°†ä»¥ `Buffer` å½¢å¼è¡¨ç¤ºã€‚
  - å¦‚æœæŒ‡å®šäº†ç¼–ç ï¼ˆæ¯”å¦‚ `utf8`ï¼‰ï¼Œè¿”å›çš„æ•°æ®å°†ä»¥å¯¹åº”ç¼–ç çš„å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚
- **åŒæ­¥ä¸å¼‚æ­¥è¯»å–**
  - Node.js çš„æ–‡ä»¶è¯»å–æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šåŒæ­¥å’Œå¼‚æ­¥ã€‚
  - **åŒæ­¥è¯»å–**ï¼šä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œç›´åˆ°æ–‡ä»¶è¯»å–å®Œæˆã€‚é€‚ç”¨äºç®€å•çš„è„šæœ¬æˆ–åˆå§‹åŒ–é˜¶æ®µã€‚
  - **å¼‚æ­¥è¯»å–**ï¼šä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚
- **é€‚ç”¨åœºæ™¯**
  - **å°æ–‡ä»¶**ï¼šç›´æ¥ä½¿ç”¨ `fs.readFile` æˆ– `fs.readFileSync`ã€‚
  - **å¤§æ–‡ä»¶**ï¼šä½¿ç”¨æµå¼è¯»å–ï¼ˆ`fs.createReadStream`ï¼‰ä»¥èŠ‚çœå†…å­˜ã€‚
  - **å®æ—¶æ€§è¦æ±‚é«˜**ï¼šä¼˜å…ˆé€‰æ‹©å¼‚æ­¥æ–¹æ³•ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚
  - **ç®€å•è„šæœ¬**ï¼šå¯ä»¥ä½¿ç”¨åŒæ­¥æ–¹æ³•ï¼Œä½†éœ€æ³¨æ„æ€§èƒ½é—®é¢˜ã€‚

## 2. ğŸ’» demos.1 - å¼‚æ­¥è¯»å– - `fs.readFile`

::: code-group

```javascript [1.cjs]
const fs = require('fs')
const path = require('path')

const filePath = path.join(__dirname, '1.txt')

fs.readFile(filePath, 'utf8', (err, data) => {
  if (err) {
    console.error('è¯»å–æ–‡ä»¶å¤±è´¥:', err)
    return
  }
  console.log('æ–‡ä»¶å†…å®¹:', data)
})

// è¾“å‡ºï¼š
// æ–‡ä»¶å†…å®¹: test

// æ³¨è§£ï¼š
// fs.readFile(path[, options], callback)
// pathï¼šæ–‡ä»¶è·¯å¾„ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ– Bufferï¼‰ã€‚
// optionsï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šç¼–ç ï¼ˆå¦‚ 'utf8'ï¼‰æˆ–å…¶ä»–é€‰é¡¹ã€‚
// callbackï¼šå›è°ƒå‡½æ•°ï¼Œæ ¼å¼ä¸º (err, data)ã€‚
//   å¦‚æœè¯»å–æˆåŠŸï¼Œdata åŒ…å«æ–‡ä»¶å†…å®¹ã€‚
//   å¦‚æœè¯»å–å¤±è´¥ï¼Œerr åŒ…å«é”™è¯¯ä¿¡æ¯ã€‚
```

```txt [1.txt]
test
```

:::

## 3. ğŸ’» demos.2 - åŒæ­¥è¯»å– - `fs.readFileSync`

::: code-group

```javascript [1.cjs]
const fs = require('fs')
const path = require('path')

const filePath = path.join(__dirname, '1.txt')

try {
  const data1 = fs.readFileSync(filePath, 'utf8')
  const data2 = fs.readFileSync(filePath)
  console.log(data1) // test
  console.log(typeof data1) // string
  console.log(data2) // <Buffer 74 65 73 74 0a>
  console.log(typeof data2) // object
} catch (err) {
  console.error('è¯»å–æ–‡ä»¶å¤±è´¥:', err)
}

// fs.readFileSync(path[, options])

// å‚æ•°è§£é‡Šï¼š
// pathï¼šæ–‡ä»¶è·¯å¾„ã€‚
// optionsï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šç¼–ç ã€‚

// è¿”å›å€¼ï¼š
// å¦‚æœæŒ‡å®šäº†ç¼–ç ï¼ˆå¦‚ 'utf8'ï¼‰ï¼Œè¿”å›å­—ç¬¦ä¸²ã€‚
// å¦‚æœæœªæŒ‡å®šç¼–ç ï¼Œè¿”å› Buffer å¯¹è±¡ã€‚
```

```txt [1.txt]
test
```

:::

## 4. ğŸ’» demos.3 - æµå¼è¯»å– - `fs.createReadStream`

::: code-group

```javascript [1.cjs]
const fs = require('fs')
const path = require('path')

const filePath = path.join(__dirname, '1.txt')

const stream = fs.createReadStream(filePath, { encoding: 'utf8' })

stream.on('data', (chunk) => {
  console.log('è¯»å–åˆ°çš„æ•°æ®å—:', chunk)
})

stream.on('end', () => {
  console.log('æ–‡ä»¶è¯»å–å®Œæ¯•')
})

stream.on('error', (err) => {
  console.error('è¯»å–æ–‡ä»¶å¤±è´¥:', err)
})

// è¾“å‡ºï¼š
// è¯»å–åˆ°çš„æ•°æ®å—: test
// æ–‡ä»¶è¯»å–å®Œæ¯•

// fs.createReadStream(path[, options])
// å¯¹äºå¤§æ–‡ä»¶ï¼Œä½¿ç”¨æµå¼è¯»å–å¯ä»¥é¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚

// å‚æ•°è§£é‡Šï¼š
// pathï¼šæ–‡ä»¶è·¯å¾„ã€‚
// optionsï¼šå¯é€‰å‚æ•°ï¼Œä¾‹å¦‚æŒ‡å®šç¼–ç æˆ–è¯»å–èŒƒå›´ã€‚

// è¡¥å……ï¼š
// demos ä¸­çš„ 1.txt æ–‡ä»¶å¹¶éå¤§å‹æ–‡ä»¶
// ä¸€æ¬¡å°±è¯»å®Œäº†
// åœ¨å®é™…æµ‹è¯•çš„æ—¶å€™å¯æ›¿æ¢ä¸ºä½“ç§¯å¤§ä¸€äº›çš„å›¾ç‰‡èµ„æºæˆ–è€…è§†é¢‘èµ„æºèµ„æºæ¥æµ‹è¯•
```

```txt [1.txt]
test
```

:::

## 5. ğŸ’» demos.4 - æ¨¡æ‹Ÿå¬æ­Œæ—¶æ˜¾ç¤ºæ­Œè¯çš„æ•ˆæœ

::: code-group

```js [1.cjs]
const fs = require('fs')
const path = require('path')

// å®šä¹‰æ­Œè¯æ–‡ä»¶è·¯å¾„
const songFilePath = path.join(__dirname, 'song.txt')

/**
 * è§£ææ­Œè¯è¡Œï¼Œæå–æ—¶é—´æˆ³å’Œå†…å®¹
 * @param {string} line - æ­Œè¯æ–‡ä»¶çš„ä¸€è¡Œ
 * @returns {Object|null} - è¿”å›è§£æåçš„å¯¹è±¡ï¼ŒåŒ…å«æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰å’Œå†…å®¹ï¼›å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å› null
 */
function parseLyricLine(line) {
  const reg = /\[(\d{2}):(\d{2})\.(\d{2})\]\s*(.+)/
  const matches = reg.exec(line)
  if (!matches) return null

  // æå–åˆ†é’Ÿã€ç§’ã€æ¯«ç§’å’Œæ­Œè¯å†…å®¹
  const [_, minutes, seconds, milliseconds, content] = matches
  const time =
    parseInt(minutes, 10) * 60 * 1000 +
    parseInt(seconds, 10) * 1000 +
    parseInt(milliseconds, 10)

  return { time, content }
}

/**
 * å¤„ç†æ­Œè¯æ–‡ä»¶å†…å®¹ï¼Œå®šæ—¶è¾“å‡ºæ­Œè¯
 * @param {string} data - æ­Œè¯æ–‡ä»¶çš„å®Œæ•´å†…å®¹
 */
function processLyrics(data) {
  const lines = data.split('\n') // æŒ‰è¡Œåˆ†å‰²æ­Œè¯

  lines.forEach((line) => {
    const parsedLine = parseLyricLine(line)
    if (parsedLine) {
      // ä½¿ç”¨ setTimeout å®šæ—¶è¾“å‡ºæ­Œè¯
      setTimeout(() => {
        console.log(parsedLine.content)
      }, parsedLine.time)
    }
  })
}

/**
 * ä¸»å‡½æ•°ï¼šè¯»å–æ­Œè¯æ–‡ä»¶å¹¶å¤„ç†
 */
function main() {
  fs.readFile(songFilePath, 'utf8', (err, data) => {
    if (err) {
      console.error(`è¯»å–æ­Œè¯æ–‡ä»¶å¤±è´¥: ${err.message}`)
      return
    }

    try {
      processLyrics(data) // å¤„ç†æ­Œè¯å†…å®¹
    } catch (error) {
      console.error(`å¤„ç†æ­Œè¯æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`)
    }
  })
}

// æ‰§è¡Œä¸»å‡½æ•°
main()
```

```txt [song.txt]
[ti:hello]
[ar:å¼ é‘«]
[t_time:(03:46)]
[00:00.00] hello - å¼ é‘«
[00:02.00] è¯ï¼šç‹äºº
[00:04.00] æ›²ï¼šç‹äºº
[00:06.00] ç¼–æ›²ï¼šæ¢æ¡¦
[00:08.00] æ­Œè¯ç¼–è¾‘ï¼šä¸œä¸œ
[00:18.23] æ¯ä»¶äº‹æƒ…éƒ½æœ‰å‘ç”Ÿçš„ç†ç”±
[00:21.72] å¯æ— æ³•è§£é‡Š é‡è§ä½ 
[00:26.15] å†å¤šçš„å¿ƒç†å‡†å¤‡ éƒ½æŠµæŠ—ä¸äº†
[00:29.89] è¢«ç°å®æ‰“è´¥çš„çˆ±æƒ…
[00:34.27] æˆ‘ä»¬éƒ½ä¹ æƒ¯äº†åŒä¸€ä¸ªæ¸©åº¦
[00:38.08] ä½ è¯´è¿™å«å¹¸ç¦
[00:42.32] åŒæ—¶ä¹Ÿå¿½ç•¥äº†ä¸€ç§æ®‹é…·
[00:45.39] æˆ‘è§‰å¾— å¥½æ— åŠ©
[00:50.69] æˆ‘æƒ³ æˆ‘æƒ³
[00:53.54] æˆ‘æƒ³ä¸€èµ·è¶Šè¿‡æ‰€æœ‰å›°éš¾å’Œé˜»æŒ¡
[00:57.64] è€Œæˆ‘ä»¬ å´ä¸ä¸€æ ·
[01:01.58] è™½ç„¶éƒ½æœ‰å…±åŒçš„ç†æƒ³
[01:06.10] çª—å¤– æœ‰é˜³å…‰
[01:09.76] é€è¿‡äº†ä¸€ä¸ç¼éš™ç…§äº®äº†ä¸€ç‚¹å¸Œæœ›
[01:14.07] è€Œæ™šä¸Š çš„æœˆäº®
[01:17.94] è®©æˆ‘ä»¬å†æ¬¡é™·å…¥äº†å½·å¾¨
[01:25.66] ä½ é—®ä¸ºä»€ä¹ˆå–œæ¬¢æ‹ç…§è®°å½•
[01:29.27] ç­”æ¡ˆæˆ‘å´è¯´ä¸å‡º
[01:33.17] æ€•å¦‚æœæˆ‘ä»¬èµ°äº†ä¸åŒæ–¹å‘
[01:37.06] æœ‰ç…§ç‰‡è®©æˆ‘å›é¡¾
[01:41.36] å›å¿†æˆ‘ä»¬å»è¿‡çš„æ¯ä¸€ä¸ªåœ°æ–¹
[01:45.41] å’Œæ—¶è€Œåœé¡¿çš„è„šæ­¥
[01:49.43] å°±è¿™ä¹ˆåœåœé¡¿é¡¿ä¸€æ­¥æ¥ä¸€æ­¥
[01:53.75] ç›´åˆ°æ²¡æœ‰è·¯
[01:57.91] æˆ‘æƒ³ æˆ‘æƒ³
[02:00.86] æˆ‘æƒ³ä¸€èµ·è¶Šè¿‡æ‰€æœ‰å›°éš¾å’Œé˜»æŒ¡
[02:04.95] è€Œæˆ‘ä»¬ å´ä¸ä¸€æ ·
[02:08.74] è™½ç„¶éƒ½æœ‰å…±åŒçš„ç†æƒ³
[02:13.15] çª—å¤– æœ‰é˜³å…‰
[02:16.83] é€è¿‡äº†ä¸€ä¸ç¼éš™ç…§äº®äº†ä¸€ç‚¹å¸Œæœ›
[02:21.01] è€Œæ™šä¸Š çš„æœˆäº®
[02:25.30] è®©æˆ‘ä»¬å†æ¬¡é™·å…¥äº†å½·å¾¨
[02:30.44] å¦‚æœæ¯ä¸€ä¸ªæ¸…æ™¨
[02:33.82] åœ¨ä½ çš„æ¸©åº¦é‡Œè‹é†’
[02:37.82] é—­çœ¼è†å¬ æœ‰èŠ‚å¥çš„å‘¼å¸
[02:41.63] å“ªæ€•åªæ˜¯ä¸€ç¬é—´
[02:43.68] å“ªæ€•åªæ˜¯ä¸€åœºæ¢¦
[02:50.74] æˆ‘æƒ³ æˆ‘æƒ³
[02:53.60] æˆ‘æƒ³ä¸€èµ·è¶Šè¿‡æ‰€æœ‰å›°éš¾å’Œé˜»æŒ¡
[02:57.73] è€Œæˆ‘ä»¬ å´ä¸ä¸€æ ·
[03:01.43] è™½ç„¶éƒ½æœ‰å…±åŒçš„ç†æƒ³
[03:06.16] çª—å¤– æœ‰é˜³å…‰
[03:09.81] é€è¿‡äº†ä¸€ä¸ç¼éš™ç…§äº®äº†ä¸€ç‚¹å¸Œæœ›
[03:13.72] è€Œæ™šä¸Š çš„æœˆäº®
[03:18.04] è®©æˆ‘ä»¬å†æ¬¡é™·å…¥äº†å½·å¾¨
[03:23.35] æ¯ä»¶äº‹æƒ…éƒ½æœ‰å‘ç”Ÿçš„ç†ç”±
[03:26.88] å¯æ— æ³•è§£é‡Š é‡è§ä½ 
[03:31.17] å†å¤šçš„å¿ƒç†å‡†å¤‡ éƒ½æŠµæŠ—ä¸äº†
[03:35.11] è¢«å‘½è¿å®‰æ’çš„ç›¸é‡
```

:::

- æœ€ç»ˆæ•ˆæœï¼šæ¯ä¸€è¡Œçš„æ­Œè¯ï¼Œåœ¨æ—¶é—´åˆ°äº†ä¹‹åæ‰ä¼šè¾“å‡ºã€‚

::: swiper

![1](https://cdn.jsdelivr.net/gh/tnotesjs/imgs@main/2025-04-15-22-11-50.png)

![2](https://cdn.jsdelivr.net/gh/tnotesjs/imgs@main/2025-04-15-22-12-06.png)

![3](https://cdn.jsdelivr.net/gh/tnotesjs/imgs@main/2025-04-15-22-12-48.png)

:::

> demo fromï¼š`ã€ŠNode.js ä»å…¥é—¨åˆ°ç²¾é€šã€‹ ä¾‹7.1`

## 6. ğŸ”— å¼•ç”¨

- https://nodejs.org/api/fs.html
  - Node.js å®˜æ–¹æ–‡æ¡£ - File system
