# [0052. EventEmitter](https://github.com/tnotesjs/TNotes.nodejs/tree/main/notes/0052.%20EventEmitter)

<!-- region:toc -->

- [1. ğŸ“ æ¦‚è¿°](#1--æ¦‚è¿°)
- [2. ğŸ“’ EventEmitter](#2--eventemitter)
- [3. ğŸ’» demos.1 - `on`ã€`addListener`ã€`emit` ç»‘å®šäº‹ä»¶å’Œè§¦å‘äº‹ä»¶](#3--demos1---onaddlisteneremit-ç»‘å®šäº‹ä»¶å’Œè§¦å‘äº‹ä»¶)
- [4. ğŸ’» demos.2 - å¤šæ¬¡ `emit` è§¦å‘å¤šæ¬¡äº‹ä»¶](#4--demos2---å¤šæ¬¡-emit-è§¦å‘å¤šæ¬¡äº‹ä»¶)
- [5. ğŸ’» demos.3 - è§¦å‘äº‹ä»¶çš„æ—¶å€™å¯æºå¸¦å‚æ•°](#5--demos3---è§¦å‘äº‹ä»¶çš„æ—¶å€™å¯æºå¸¦å‚æ•°)
- [6. ğŸ’» demos.4 - `once` ç»‘å®šçš„äº‹ä»¶åªä¼šè§¦å‘ä¸€æ¬¡](#6--demos4---once-ç»‘å®šçš„äº‹ä»¶åªä¼šè§¦å‘ä¸€æ¬¡)
- [7. ğŸ’» demos.5 - `off`ã€`removeListener` è§£ç»‘](#7--demos5---offremovelistener-è§£ç»‘)
- [8. ğŸ’» demos.6 - å¤šæ¬¡ `on` å¯ç»‘å®šå¤šä¸ªäº‹ä»¶](#8--demos6---å¤šæ¬¡-on-å¯ç»‘å®šå¤šä¸ªäº‹ä»¶)
- [9. ğŸ’» demos.7 - `listenerCount` è·å–ç›‘å¬å™¨æ•°é‡](#9--demos7---listenercount-è·å–ç›‘å¬å™¨æ•°é‡)
- [10. ğŸ’» demos.8 - `removeAllListeners` ç§»é™¤æ‰€æœ‰çš„ç›‘å¬å™¨](#10--demos8---removealllisteners-ç§»é™¤æ‰€æœ‰çš„ç›‘å¬å™¨)
- [11. ğŸ’» demos.9 - `emit` æ˜¯åŒæ­¥çš„](#11--demos9---emit-æ˜¯åŒæ­¥çš„)
- [12. ğŸ’» demos.10 - `emit` ä¸€ä¸ªä¸å­˜åœ¨çš„äº‹ä»¶](#12--demos10---emit-ä¸€ä¸ªä¸å­˜åœ¨çš„äº‹ä»¶)
- [13. ğŸ’» demos.11 - ç‰¹æ®Šçš„ `error` äº‹ä»¶](#13--demos11---ç‰¹æ®Šçš„-error-äº‹ä»¶)
- [14. ğŸ’» demos.12 - `setMaxListeners(limit)` è®¾ç½®å¯ä»¥ç›‘å¬çš„æœ€å¤§å›è°ƒå‡½æ•°æ•°é‡](#14--demos12---setmaxlistenerslimit-è®¾ç½®å¯ä»¥ç›‘å¬çš„æœ€å¤§å›è°ƒå‡½æ•°æ•°é‡)
- [15. ğŸ”— å¼•ç”¨](#15--å¼•ç”¨)

<!-- endregion:toc -->

## 1. ğŸ“ æ¦‚è¿°

- æŒæ¡ EventEmitter æ¨¡å—çš„åŸºæœ¬ä½¿ç”¨
- è®¤è¯†äº‹ä»¶é©±åŠ¨æ¶æ„

## 2. ğŸ“’ EventEmitter

- **äº‹ä»¶ `events`**
  - Node.js æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½å¯ä»¥è§†ä¸ºäº‹ä»¶å¤„ç†ã€‚
  - `events` æ¨¡å—æ˜¯ Node.js ä¸­ç”¨äºå®ç°äº‹ä»¶é©±åŠ¨çš„æ ¸å¿ƒæ¨¡å—ï¼Œè€Œ `EventEmitter` ç±»åˆ™æ˜¯è¯¥æ¨¡å—çš„æ ¸å¿ƒã€‚
  - **äº‹ä»¶é©±åŠ¨**ï¼š
    - `EventEmitter` æ˜¯ Node.js çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œå®ƒæä¾›äº†å®ç° **äº‹ä»¶é©±åŠ¨æ¶æ„** çš„åŸºæœ¬å·¥å…·ã€‚åœ¨ Node.js å’ŒåŸºäº Node.js çš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ Electronï¼‰ä¸­ï¼Œäº‹ä»¶é©±åŠ¨æ¶æ„æ˜¯ä¸€ä¸ªæ ¸å¿ƒçš„è®¾è®¡ç†å¿µã€‚
  - **æ¨¡å—é—´è§£è€¦**ï¼š
    - é€šè¿‡äº‹ä»¶ï¼Œä¸åŒçš„æ¨¡å—å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¼•ç”¨å¯¹æ–¹ã€‚
  - **å®ç°è§‚å¯Ÿè€…æ¨¡å¼**ï¼š
    - EventEmitter æä¾›äº†ä¸€ç§å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„æœºåˆ¶ï¼Œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚
  - **éé˜»å¡ I/O**ï¼š
    - é€šè¿‡ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥éé˜»å¡åœ°å¤„ç† I/Oï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨ç­‰å¾… I/Oï¼ˆå¦‚ç½‘ç»œè¯·æ±‚æˆ–æ–‡ä»¶è¯»å–ï¼‰å®Œæˆæ—¶åšå…¶ä»–äº‹æƒ…ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚
- **EventEmitter**
  - **å®šä¹‰**ï¼š`EventEmitter` æ˜¯ Node.js ä¸­ç”¨äºå¤„ç†äº‹ä»¶çš„æ ¸å¿ƒç±»ï¼Œå…è®¸å¯¹è±¡è®¢é˜…å’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚
  - **ä½œç”¨**ï¼šå®ƒæ˜¯ Node.js äº‹ä»¶é©±åŠ¨æ¶æ„çš„åŸºç¡€ï¼Œå¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ä¸­ã€‚
  - **ä½¿ç”¨åœºæ™¯**ï¼š
    - å¤„ç†ç”¨æˆ·äº¤äº’ï¼ˆå¦‚ç‚¹å‡»ã€é”®ç›˜è¾“å…¥ç­‰ï¼‰ã€‚
    - è‡ªå®šä¹‰äº‹ä»¶çš„å‘å¸ƒä¸è®¢é˜…ã€‚
    - å®ç°è§‚å¯Ÿè€…æ¨¡å¼ã€‚
  - **ä½¿ç”¨**ï¼šè¦ä½¿ç”¨ `EventEmitter`ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥ `events` æ¨¡å—å¹¶åˆ›å»ºå®ä¾‹ï¼š

```javascript
const EventEmitter = require('events')
const eventEmitter = new EventEmitter()
// å®ƒæä¾›äº†ä¸°å¯Œçš„äº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œæ‰€æœ‰å¯ä»¥æ·»åŠ ç›‘å¬äº‹ä»¶çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª EventEmitterã€‚
```

- **ä¸ªäººè¯„ä»·**ï¼š
  - `EventEmitter` åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨ç›¸å¯¹è¾ƒå°‘ï¼Œå¿«é€Ÿå°† demos ç»™è¿‡ä¸€éå³å¯ã€‚
  - é‡ç‚¹åœ¨äºè®¤è¯†â€œäº‹ä»¶é©±åŠ¨æ¶æ„â€æ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„ç¼–ç¨‹ä½“éªŒï¼Œè¿™å¯¹äºæˆ‘ä»¬å­¦ä¹ é‚£äº›åŸºäº NodeJS å®ç°çš„æ¡†æ¶è€Œè¨€ï¼Œå¸®åŠ©æ˜¯å¾ˆå¤§çš„ã€‚
    - æ¯”å¦‚ï¼ŒElectron å°±æ˜¯åŸºäº NodeJS æ¥å®ç°çš„ï¼Œåœ¨ Electron ä¸­ï¼Œç”¨äºå®ç° IPC é€šä¿¡çš„æ¨¡å— `ipcMain`ã€`ipcRenderer` éƒ½æ˜¯åŸºäº `EventEmitter` å®ç°çš„ï¼Œäº†è§£ `EventEmitter` çš„ä¸€äº›å¸¸ç”¨ APIï¼Œæœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ `ipcMain`ã€`ipcRenderer`ã€‚
  - ä¸‹é¢æ˜¯ `EventEmitter` æ¨¡å—ç›¸å¯¹å¸¸è§ä¸€äº›çš„ APIï¼š

| æ–¹æ³• | æè¿° |
| --- | --- |
| `emitter.on(eventName, listener)` | ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å™¨ä¼šåœ¨æ¯æ¬¡è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œã€‚ |
| `emitter.emit(eventName[, ...args])` | è§¦å‘æŒ‡å®šäº‹ä»¶ï¼Œå¹¶ä¼ é€’å¯é€‰å‚æ•°ç»™ç›‘å¬å™¨ã€‚ |
| `emitter.once(eventName, listener)` | ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªå•æ¬¡ç›‘å¬å™¨ï¼Œç›‘å¬å™¨æœ€å¤šåªä¼šè§¦å‘ä¸€æ¬¡ï¼Œè§¦å‘åè‡ªåŠ¨ç§»é™¤ã€‚ |
| `emitter.removeListener(eventName, listener)` | ç§»é™¤æŒ‡å®šäº‹ä»¶çš„æŸä¸ªç›‘å¬å™¨ã€‚ |
| `emitter.removeAllListeners([eventName])` | ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼Œå¦‚æœæŒ‡å®šäº† `eventName`ï¼Œåˆ™ä»…ç§»é™¤è¯¥äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ã€‚ |

## 3. ğŸ’» demos.1 - `on`ã€`addListener`ã€`emit` ç»‘å®šäº‹ä»¶å’Œè§¦å‘äº‹ä»¶

::: code-group

<<< ./demos/1/1.cjs {js} [1.cjs]

:::

## 4. ğŸ’» demos.2 - å¤šæ¬¡ `emit` è§¦å‘å¤šæ¬¡äº‹ä»¶

::: code-group

<<< ./demos/2/1.cjs {js} [1.cjs]

:::

## 5. ğŸ’» demos.3 - è§¦å‘äº‹ä»¶çš„æ—¶å€™å¯æºå¸¦å‚æ•°

::: code-group

<<< ./demos/3/1.cjs {js} [1.cjs]

:::

## 6. ğŸ’» demos.4 - `once` ç»‘å®šçš„äº‹ä»¶åªä¼šè§¦å‘ä¸€æ¬¡

::: code-group

<<< ./demos/4/1.cjs {js} [1.cjs]

:::

## 7. ğŸ’» demos.5 - `off`ã€`removeListener` è§£ç»‘

::: code-group

<<< ./demos/5/1.cjs {js} [1.cjs]

:::

## 8. ğŸ’» demos.6 - å¤šæ¬¡ `on` å¯ç»‘å®šå¤šä¸ªäº‹ä»¶

::: code-group

<<< ./demos/6/1.cjs {js} [1.cjs]

<<< ./demos/6/2.cjs {js} [2.cjs]

<<< ./demos/6/3.cjs {js} [3.cjs]

:::

## 9. ğŸ’» demos.7 - `listenerCount` è·å–ç›‘å¬å™¨æ•°é‡

::: code-group

<<< ./demos/7/1.cjs {js} [1.cjs]

:::

## 10. ğŸ’» demos.8 - `removeAllListeners` ç§»é™¤æ‰€æœ‰çš„ç›‘å¬å™¨

::: code-group

<<< ./demos/8/1.cjs {16,21 js} [1.cjs]

<<< ./demos/8/2.cjs {18 js} [2.cjs]

:::

## 11. ğŸ’» demos.9 - `emit` æ˜¯åŒæ­¥çš„

::: code-group

<<< ./demos/9/1.cjs {js} [1.cjs]

:::

## 12. ğŸ’» demos.10 - `emit` ä¸€ä¸ªä¸å­˜åœ¨çš„äº‹ä»¶

::: code-group

<<< ./demos/10/1.cjs {js} [1.cjs]

:::

## 13. ğŸ’» demos.11 - ç‰¹æ®Šçš„ `error` äº‹ä»¶

::: code-group

<<< ./demos/11/1.cjs {js} [1.cjs]

<<< ./demos/11/2.cjs {js} [2.cjs]

<<< ./demos/11/3.cjs {js} [3.cjs]

<<< ./demos/11/4.cjs {js} [4.cjs]

<<< ./demos/11/4.txt [4.txt]

:::

- **æ‰€æœ‰çš„ EventEmitter å®ä¾‹é»˜è®¤éƒ½ä¼šæ³¨å†Œä¸€ä¸ª error äº‹ä»¶ç›‘å¬å™¨**ã€‚
- è¿™æ„å‘³ç€å¦‚æœåœ¨ EventEmitter å®ä¾‹ä¸­æ²¡æœ‰æ˜¾å¼åœ°æ³¨å†Œ error äº‹ä»¶ç›‘å¬å™¨ï¼Œå½“è§¦å‘äº†ä¸€ä¸ªé”™è¯¯äº‹ä»¶ä¸”æ²¡æœ‰å¯¹å…¶è¿›è¡Œå¤„ç†æ—¶ï¼ŒNode.js å°†ä¼šæ‰“å°é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œå¹¶å¯èƒ½å¯¼è‡´ç¨‹åºé€€å‡ºã€‚
- ä¸ºäº†é¿å…ç¨‹åºå´©æºƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `try-catch` åŒ…è£¹ä¸€ä¸‹ `eIns.emit('error')`ã€‚è¿™æ ·å¯ä»¥ä¿è¯å³ä½¿å‡ºç°é”™è¯¯ï¼Œç¨‹åºä¹Ÿèƒ½å¤Ÿç»§ç»­æ‰§è¡Œï¼Œå¹¶é‡‡å–é€‚å½“çš„æªæ–½æ¥å¤„ç†é”™è¯¯æƒ…å†µã€‚
- **å¦‚æœä¸æƒ³ä½¿ç”¨ try-catchï¼ŒåŒæ—¶åˆè¦é¿å…ç¨‹åºå´©æºƒï¼Œå»ºè®®åœ¨ä½¿ç”¨ EventEmitter çš„æ—¶å€™ï¼Œå§‹ç»ˆä¸º error äº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ•è·å’Œå¤„ç†é”™è¯¯ã€‚**
- åœ¨ Node.js ä¸­ï¼Œå¾ˆå¤šæ¨¡å—çš„é”™è¯¯å¤„ç†éƒ½æ˜¯ç›‘å¬ `error` äº‹ä»¶çš„åŸå› å°±åœ¨äºå®ƒä»¬éƒ½æ˜¯ç»§æ‰¿è‡ª `EventEmitter` çš„ï¼Œå› æ­¤ï¼Œå½“é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼Œå¦‚æœä½ æƒ³è¦å®šä¹‰ç›¸å…³çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¹Ÿåº”è¯¥ç›‘å¬ `error` äº‹ä»¶æ‰å¯¹ã€‚

## 14. ğŸ’» demos.12 - `setMaxListeners(limit)` è®¾ç½®å¯ä»¥ç›‘å¬çš„æœ€å¤§å›è°ƒå‡½æ•°æ•°é‡

::: code-group

<<< ./demos/12/1.cjs {js} [1.cjs]

<<< ./demos/12/2.cjs {js} [2.cjs]

<<< ./demos/12/3.cjs {js} [3.cjs]

:::

## 15. ğŸ”— å¼•ç”¨

- https://www.runoob.com/nodejs/nodejs-event.html
  - èœé¸Ÿæ•™ç¨‹ - Node.js EventEmitter
- https://nodejs.org/dist/latest-v18.x/docs/api/events.html#class-eventemitter
  - Node.js å®˜æ–¹æ–‡æ¡£ - EventEmitter
